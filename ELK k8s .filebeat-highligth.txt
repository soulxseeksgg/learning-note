
____________         ___________        ________________          _________
| filebeat |  --->> | logstash |  --->> | elasticsearch | --->>  | kibana |
                        

#‡πÄ‡∏Ç‡πâ‡∏≤ container ‡∏ú‡πà‡∏≤‡∏ô command 
  kubectl exec -it filebeat-589bb7446-67xbn -n elk -- /bin/sh
#call
  echo '{"log": "gg"}' | filebeat -e  //‡πÑ‡∏°‡πà‡πÑ‡∏™‡πà -e ‡πÑ‡∏°‡πà print

   
regsitry read log path ‡∏à‡∏≥‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  /usr/share/filebeat/data/registry/filebeat/data.json


#‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏≤‡∏¢ input ‡πÑ‡∏î‡πâ‡πÅ‡∏ï‡πà‡∏≠‡∏≠‡∏Å output ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
You can have as many inputs as you want but you can in filebeat
Only a single output may be defined


link ‡∏•‡∏π‡∏Å‡∏û‡∏µ‡πà ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ
  https://discuss.elastic.co/t/reading-both-container-logs-and-host-logs-on-k8s/154683/3       


 type: kubernetes: ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Kubernetes pod ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà Kubernetes API ‡πÉ‡∏´‡πâ ‡πÄ‡∏ä‡πà‡∏ô label, namespace ‡∏´‡∏£‡∏∑‡∏≠ pod name ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤ container ‡πÑ‡∏´‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö log
 condition: ‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤ container ‡πÉ‡∏î‡∏ö‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å container ‡∏ó‡∏µ‡πà‡∏°‡∏µ label app: myapp)
 config: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏≤‡∏ò‡∏ó‡∏µ‡πà Filebeat ‡∏à‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• log ‡∏Ç‡∏≠‡∏á container  

 
#‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô
‡πÑ‡∏ü‡∏•‡πå yaml ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏≤‡∏Å kubernetes

API Group ‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 2 ‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å ‡πÜ
  1.‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠ API group ‡πÉ‡∏ä‡πâ apiVersion: v1
    ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á resource ‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
      Pod
      Service
      Node
      Namespace
      ConfigMap
      Secret
      PersistentVolume (PV)
      PersistentVolumeClaim (PVC)

   2. ‡πÅ‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö apiVersion: <group>/<version>  //‡∏ï‡∏£‡∏á version ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô v1 ‡πÄ‡∏™‡∏°‡∏≠
      group ‡πÅ‡∏ö‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô
      ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Å‡∏•‡∏∏‡πà‡∏° ‡πÄ‡∏ä‡πà‡∏ô:
        apps ‚Üí ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö Deployment, DaemonSet, StatefulSet
        batch ‚Üí ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö Job, CronJob
        networking.k8s.io ‚Üí ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö Ingress, NetworkPolicy
        rbac.authorization.k8s.io ‚Üí (rbac ‡∏Ñ‡∏∑‡∏≠  Role-Based Access Control) ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö Role, RoleBinding, ClusterRole, ClusterRoleBinding
        policy ‚Üí ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö PodSecurityPolicy
        storage.k8s.io ‚Üí ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö StorageClass, VolumeAttachment
        autoscaling ‚Üí ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö HorizontalPodAutoscaler
        apiextensions.k8s.io ‚Üí ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö CustomResourceDefinition (CRD)
        admissionregistration.k8s.io ‚Üí ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö ValidatingWebhookConfiguration, MutatingWebhookConfiguration


          #‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á app
          kind: DaemonSet  # kind ‡πÅ‡∏ö‡∏ö 1 pod ‡∏ï‡πà‡∏≠ 1 node 
          # ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ ReplicaSet ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô replicas
          # ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Node ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‚Üí DaemonSet ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Pod ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ 
          # ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö filebeat, fluentd (‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å Node ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡πá‡∏ö logs)

          kind: Deployment #‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏´‡∏•‡∏≤‡∏¢‡πÜ Pod ‡∏ó‡∏µ‡πà scale ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°:
              # ‡πÉ‡∏ä‡πâ ReplicaSet ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô replicas
              # ‡∏°‡∏µ Rolling Update (‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î Pod ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏°‡∏µ downtime)
              # Stateless Applications ‡πÄ‡∏ä‡πà‡∏ô Web Server, API Service ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏™‡∏°‡∏≠‡πÄ‡∏ä‡πà‡∏ô‡πÅ‡∏≠‡∏û api ,  Backend Service ‡∏ó‡∏µ‡πà scale ‡πÑ‡∏î‡πâ‡∏≠‡∏¥‡∏™‡∏£‡∏∞

          Kind: StatefulSet #Pod ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞ storage ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
              ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°:
              # Pod ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏à‡∏∞‡∏°‡∏µ‡πÄ‡∏•‡∏Ç‡∏•‡∏≥‡∏î‡∏±‡∏ö (my-pod-0, my-pod-1, my-pod-2)
              # Pod ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô ‡πÅ‡∏ï‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö
              # Pod ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÑ‡∏õ ‚Üí ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏°
              # ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö Stateful Applications ‡πÄ‡∏ä‡πà‡∏ô Database, Zookeeper, Kafka
              ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:
              Database ‡πÄ‡∏ä‡πà‡∏ô MySQL, PostgreSQL, MongoDB
              Distributed Systems ‡πÄ‡∏ä‡πà‡∏ô Zookeeper, Kafka

            +-------------------------+-------------------------+-------------------------+-------------------------+
            |        Feature          |        DaemonSet        |       Deployment        |      StatefulSet        |
            +-------------------------+-------------------------+-------------------------+-------------------------+
            |        ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Pod        |       1 ‡∏ï‡πà‡∏≠ Node         |        ‡∏ï‡∏≤‡∏° replicas     |       ‡∏ï‡∏≤‡∏° replicas      |
            +-------------------------+-------------------------+-------------------------+-------------------------+
            |      ‡πÉ‡∏ä‡πâ ReplicaSet?     |           ‚ùå            |           ‚úÖ             |           ‚ùå            |
            +-------------------------+-------------------------+-------------------------+-------------------------+
            |        Scaling          |     ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏î‡∏ï‡∏≤‡∏° Node       |          ‡∏≠‡∏¥‡∏™‡∏£‡∏∞           |       ‡∏ï‡∏≤‡∏° replicas      |
            +-------------------------+-------------------------+-------------------------+-------------------------+
            |       Pod Identity      |        ‡πÑ‡∏°‡πà‡∏™‡∏ô‡πÉ‡∏à‡∏ä‡∏∑‡πà‡∏≠         |        ‡πÑ‡∏°‡πà‡∏™‡∏ô‡πÉ‡∏à‡∏ä‡∏∑‡πà‡∏≠         |  ‡∏°‡∏µ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠ (pod-0, pod-1) |
            +-------------------------+-------------------------+-------------------------+-------------------------+
            |      Rolling Update     |           ‡πÉ‡∏ä‡πà            |           ‡πÉ‡∏ä‡πà            |     ‡πÉ‡∏ä‡πà (‡πÅ‡∏ï‡πà‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß)        |
            +-------------------------+-------------------------+-------------------------+-------------------------+
            |        ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏≠‡∏∞‡πÑ‡∏£?        | Agents, Log Collector   | Web, API, Backend       | DB, Kafka, Zookeeper    |
            +-------------------------+-------------------------+-------------------------+-------------------------+

        ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏á RBAC (Role-Based Access Control)
          üîπ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢
          Role / ClusterRole ‚Üí ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡πà‡∏≤‡∏ô/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Pods)
          RoleBinding / ClusterRoleBinding ‚Üí ‡∏ú‡∏π‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö Users, Groups ‡∏´‡∏£‡∏∑‡∏≠ ServiceAccounts
          Subjects ‚Üí ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (User, Group, ServiceAccount)
          Verbs ‚Üí ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£ (‡πÄ‡∏ä‡πà‡∏ô get, list, create, delete)
          Resources ‚Üí ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏±‡∏ö‡∏≠‡∏∞‡πÑ‡∏£ (‡πÄ‡∏ä‡πà‡∏ô pods, deployments, services)  

          ‡πÄ‡∏ä‡πà‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå yaml
          rules: //‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö kind
            - apiGroups: [""]  # ‡πÑ‡∏°‡πà‡πÑ‡∏™‡πà‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏•‡πá‡∏Å pod ‡∏°‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î group
              resources: ["pods"]  # ‡∏ö‡∏≠‡∏Å resource ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
              verbs: ["list", "get"] #‡∏î‡∏π‡πÅ‡∏•‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏û‡∏≠    


#‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
apiVersion: rbac.authorization.k8s.io/v1  
kind: ClusterRole 
metadata:
  name: filebeat-cluster-role  # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á ClusterRole
rules:
  - apiGroups: [""]  # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó apiGroups (‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ pod ‡∏°‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î group ‡πÉ‡∏î‡πÄ‡∏•‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏™‡πà)
    resources: ["pods"]  # ‡∏£‡∏∞‡∏ö‡∏∏ resource ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÄ‡∏ä‡πà‡∏ô pods ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà pods
    verbs: ["list", "get"]  # ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (verbs) ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡πÑ‡∏î‡πâ


#‡∏Å‡∏≥‡∏´‡∏ô‡∏î role
  apiVersion: rbac.authorization.k8s.io/v1
  kind: ClusterRoleBinding
  metadata:
    name: filebeat-cluster-role-binding  # ‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á ClusterRoleBinding
  subjects:
    - kind: ServiceAccount
      name: default  # user ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ( ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ServiceAccount ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô default )
      namespace: elk # namespace ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô pod ‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏¥‡∏ó‡∏ò‡πå‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏£‡∏Å
  roleRef:
    kind: ClusterRole  #‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ
    name: filebeat-cluster-role  # ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ä‡∏∑‡πà‡∏≠ ClusterRole
    apiGroup: rbac.authorization.k8s.io
      

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå yaml ‡πÄ‡∏≠‡∏á ‡∏°‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°
‡πÉ‡∏ä‡πà, ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå YAML ‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏•‡∏∂‡∏Å‡∏ã‡∏∂‡πâ‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ ‡∏ã‡∏∂‡πà‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÇ‡∏õ‡∏£ ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Kubernetes ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î.
‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÄ‡∏ä‡πà‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏ï‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Kubernetes ‡πÑ‡∏î‡πâ‡∏•‡∏∂‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô, ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏ô‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏°‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå.      


‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå
securityContext:
  fsGroup: 0   // ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å volumne ‡πÉ‡∏ä‡πâ‡πÉ‡∏ä‡πâ 0 ‡∏Ñ‡∏∑‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå root ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà‡∏ô‡∏µ‡πâ‡∏Å‡πá‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö filebeat ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ container ‡πÄ‡∏õ‡πá‡∏ô root ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á
  runAsUser: 0  // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ container ‡πÄ‡∏õ‡πá‡∏ô root ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÑ‡∏î‡πâ‡∏´‡∏°‡∏î

‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á pod
rules:
  - apiGroups: [""]  
    resources: ["pods", "namespaces", "nodes"] 
    verbs: ["list", "get","watch"]


#Processors (‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ Logstash
    ‡∏°‡∏µ
    processors:
      - add_kubernetes_metadata:
          in_cluster: true  //<<<---- ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ï‡πâ‡∏Ñ‡∏≥‡∏î‡∏µ‡πÜ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å - ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå configmap ‡∏ó‡∏µ‡πà‡∏°‡∏±‡∏ô‡πÉ‡∏ä‡πâ inclund ‡∏°‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πä‡∏∞ ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô

    processors:
      - add_fields: //‡πÄ‡∏û‡∏¥‡πà‡∏° fileds ‡πÉ‡∏´‡∏°‡πà
          fields:
            app_type: "myapp"

    processors:
      - drop_fields:  //‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÅ‡∏Ñ‡πà‡∏ö‡∏≤‡∏á tag
          fields: ["host"]

    processors:
      - rename:
          fields:
            - from: "kubernetes.namespace"
              to: "namespace"

    ----------
    processors:
      - drop_event:  //‡∏•‡∏ö‡πÅ‡∏°‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á event ‡∏Ç‡∏≠‡πÅ‡∏Ñ‡πà where ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å 
          when:
            and
              equals/regexp  https://www.elastic.co/guide/en/beats/filebeat/current/defining-processors.html#conditions
                message: "test"      
              matches
                message: '^[a-zA-Z]+$'


    "harvester" (‡∏Æ‡∏≤‡πÄ‡∏ß‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå) ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡∏ú‡∏π‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß 
    Discover ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤

----------------------------------------
filebeat.autodiscover vs filebeat.inputs 
filebeat.autodiscover (‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏á ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏û‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢ ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á ClusterRole, ClusterRoleBinding) 
filebeat.inputs (‡∏á‡πà‡∏≤‡∏¢ ‡∏™‡∏±‡πâ‡∏ô ‡∏á‡∏≤‡∏ô‡∏´‡∏¢‡∏≤‡∏ö‡∏´‡∏ô‡πà‡∏≠‡∏¢) 
‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏ô‡πÉ‡∏î‡∏≠‡∏±‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á

  filebeat.autodiscover:
      providers:
        - type: kubernetes
          host: ${NODE_NAME}
          templates:
            - condition:
                contains:
                  kubernetes.labels.app: "myapp"
              config:
                - type: container
                  paths:
                    - /var/log/containers/*${data.kubernetes.container.id}.log

    filebeat.inputs: 
      - type: container
        paths:
          - /var/log/containers/*.log  
----------------------------------------
#restart redis helm chart

NAME                                 READY   AGE
statefulset.apps/my-redis-master     1/1     5d20h
statefulset.apps/my-redis-replicas   0/0     5d20h

kubectl rollout restart statefulset my-redis-master -n redis
statefulset.apps/my-redis-master restarted


----------
‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
k apply -f filebeat.yaml
krds filebeat -n elk
kgat